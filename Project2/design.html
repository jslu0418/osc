<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Design of Project2</title>
<!-- 2018-03-30 Fri 18:43 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Jiashuai Lu" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Design of Project2</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Which Semaphores are Needed</a></li>
<li><a href="#sec-2">2. Pseudocodes</a></li>
<li><a href="#sec-3">3. Summary</a></li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Which Semaphores are Needed</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li>Nursecall
<ul class="org-ul">
<li>Nurse call patient
</li>
<li>One for each doctor
</li>
<li>Init by 0
</li>
</ul>
</li>
<li>Nursetell
<ul class="org-ul">
<li>Nurse tell doctor
</li>
<li>One for each doctor
</li>
<li>Init by 0
</li>
</ul>
</li>
<li>Patients
<ul class="org-ul">
<li>Patients waiting for register
</li>
<li>One semaphore
</li>
<li>Init by 0
</li>
</ul>
</li>
<li>Symptoms
<ul class="org-ul">
<li>Patients telling doctor their symptoms
</li>
<li>One for each patient
</li>
<li>Init by 0
</li>
</ul>
</li>
<li>Finishadvising
<ul class="org-ul">
<li>Doctor finishing a patient's advising
</li>
<li>One for each patient
</li>
<li>Init by 0
</li>
</ul>
</li>
<li>Waitingfordoctor
<ul class="org-ul">
<li>Denoting there is patient waiting for doctor
</li>
<li>One for each doctor
</li>
<li>Init by 0
</li>
</ul>
</li>
<li>Finishregistering
<ul class="org-ul">
<li>Receptionist finishing a patient's register
</li>
<li>One for each patient
</li>
<li>Init by 0
</li>
</ul>
</li>
<li>Leaves
<ul class="org-ul">
<li>Denote a patient leave status
</li>
<li>One for each patient
</li>
<li>Init by 0
</li>
</ul>
</li>
<li>Mutexes
<ul class="org-ul">
<li>Guarantee some operation to be safe
</li>
<li>two
</li>
<li>Init by 1
</li>
</ul>
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Pseudocodes</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-C" id="ClinicSimulator"><span style="color: #ffff00;">/* </span><span style="color: #ffff00;">Clinic Simulator </span><span style="color: #ffff00;">*/</span>
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">nursecall</span><span style="color: #8c8c8c;">[</span>3<span style="color: #8c8c8c;">]</span> = <span style="color: #8c8c8c;">{</span>0<span style="color: #8c8c8c;">}</span>;
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">nursetell</span><span style="color: #8c8c8c;">[</span>3<span style="color: #8c8c8c;">]</span> = <span style="color: #8c8c8c;">{</span>0<span style="color: #8c8c8c;">}</span>;
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">patients</span> = 0;
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">symptoms</span><span style="color: #8c8c8c;">[</span>30<span style="color: #8c8c8c;">]</span> = <span style="color: #8c8c8c;">{</span>0<span style="color: #8c8c8c;">}</span>;
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">finish_advising</span><span style="color: #8c8c8c;">[</span>30<span style="color: #8c8c8c;">]</span> = <span style="color: #8c8c8c;">{</span>0<span style="color: #8c8c8c;">}</span>;
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">finish_registering</span><span style="color: #8c8c8c;">[</span>30<span style="color: #8c8c8c;">]</span> = <span style="color: #8c8c8c;">{</span>0<span style="color: #8c8c8c;">}</span>;
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">leaves</span><span style="color: #8c8c8c;">[</span>30<span style="color: #8c8c8c;">]</span> = <span style="color: #8c8c8c;">{</span>0<span style="color: #8c8c8c;">}</span>;
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">waitingfordoctor</span><span style="color: #8c8c8c;">[</span>3<span style="color: #8c8c8c;">]</span> = <span style="color: #8c8c8c;">{</span>0<span style="color: #8c8c8c;">}</span>;
<span style="color: #00ff00;">semaphore</span> <span style="color: #ffff00;">mutex1</span> = 1, <span style="color: #ffff00;">mutex2</span> = 1;
<span style="color: #00ff00;">void</span> <span style="color: #0000ff; font-weight: bold;">receptionist</span><span style="color: #8c8c8c;">()</span>
<span style="color: #8c8c8c;">{</span>
    <span style="color: #00ffff; font-weight: bold;">while</span><span style="color: #93a8c6;">(</span><span style="color: #ff00ff;">true</span><span style="color: #93a8c6;">)</span>
    <span style="color: #93a8c6;">{</span>
        wait<span style="color: #b0b1a3;">(</span>patients<span style="color: #b0b1a3;">)</span>;
        dequeue_patients<span style="color: #b0b1a3;">(</span>patient_id<span style="color: #b0b1a3;">)</span>;
        assign_doctor_to_patient<span style="color: #b0b1a3;">(</span>patient_id<span style="color: #b0b1a3;">)</span>;
        signal<span style="color: #b0b1a3;">(</span>finish_registering<span style="color: #97b098;">[</span>patient_id<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span>;
    <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>
<span style="color: #00ff00;">void</span> <span style="color: #0000ff; font-weight: bold;">doctor_and_nurse</span><span style="color: #8c8c8c;">()</span>
<span style="color: #8c8c8c;">{</span>
    <span style="color: #00ffff; font-weight: bold;">while</span><span style="color: #93a8c6;">(</span><span style="color: #ff00ff;">true</span><span style="color: #93a8c6;">)</span>
    <span style="color: #93a8c6;">{</span>
        wait<span style="color: #b0b1a3;">(</span>waitingfordoctor<span style="color: #97b098;">[</span>doctor_id<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span>;
        dequeue_patients_of_doctor_id<span style="color: #b0b1a3;">(</span>doctor_id, patient_id<span style="color: #b0b1a3;">)</span>;
        signal<span style="color: #b0b1a3;">(</span>nursecall<span style="color: #97b098;">[</span>doctor_id<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span>;
        wait<span style="color: #b0b1a3;">(</span>nursetell<span style="color: #97b098;">[</span>doctor_id<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span>;
        wait<span style="color: #b0b1a3;">(</span>symptom<span style="color: #97b098;">[</span>patient_id<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span>;
        advising<span style="color: #b0b1a3;">()</span>;
        signal<span style="color: #b0b1a3;">(</span>finish_advising<span style="color: #97b098;">[</span>patient_id<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span>;
        wait<span style="color: #b0b1a3;">(</span>leaves<span style="color: #97b098;">[</span>patient_id<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span>;
    <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>
<span style="color: #00ff00;">void</span> <span style="color: #0000ff; font-weight: bold;">patient</span><span style="color: #8c8c8c;">()</span>
<span style="color: #8c8c8c;">{</span>
    enter_clinic<span style="color: #93a8c6;">()</span>;
    wait<span style="color: #93a8c6;">(</span>mutex1<span style="color: #93a8c6;">)</span>;
    enqueue_patients<span style="color: #93a8c6;">(</span>patient_id<span style="color: #93a8c6;">)</span>;
    signal<span style="color: #93a8c6;">(</span>mutex1<span style="color: #93a8c6;">)</span>;
    wait<span style="color: #93a8c6;">(</span>finish_registering<span style="color: #b0b1a3;">[</span>patient_id<span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)</span>;
    signal<span style="color: #93a8c6;">(</span>waitingfordoctor<span style="color: #b0b1a3;">[</span>doctor_id<span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)</span>;
    wait<span style="color: #93a8c6;">(</span>nursecall<span style="color: #b0b1a3;">[</span>doctor_id<span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)</span>;
    signal<span style="color: #93a8c6;">(</span>nursetell<span style="color: #b0b1a3;">[</span>doctor_id<span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)</span>;
    walking_to_doctor_office<span style="color: #93a8c6;">(</span>doctor_id<span style="color: #93a8c6;">)</span>;
    signal<span style="color: #93a8c6;">(</span>symptom<span style="color: #b0b1a3;">[</span>patient_id<span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)</span>;
    wait<span style="color: #93a8c6;">(</span>finish_advising<span style="color: #b0b1a3;">[</span>patient_id<span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)</span>;
    leave<span style="color: #93a8c6;">()</span>;
    signal<span style="color: #93a8c6;">(</span>leaves<span style="color: #b0b1a3;">[</span>patient_id<span style="color: #b0b1a3;">]</span><span style="color: #93a8c6;">)</span>;
<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Summary</h2>
<div class="outline-text-2" id="text-3">
<p>
My clinic simulator uses three types of threads and nine different types of semaphores. In this clinic program, receptionist and doctor<sub>and</sub><sub>nurse</sub> threads are most likely as daemon threads which will keep on running in loop for serving incoming patients once started. Correspondingly, the patients do not belong to our clinic, so each of them would just come and go after they get their advice from doctors.
</p>

<p>
The most difficult part of this project to me is designing the coordination between different threads to make the whole clinic is in operation regularly and each thread to perform their responsibilities successfully. At the very first I try to use more than thirteen types of semaphores in the design of my clinic. However, with the process of coding going, I realize that some of them are indeed redundant or meaningless or just incorrect. For example, I define the patients semaphore to denote how many patients are waiting for the receptionist to register for them. But I also define receptionist semaphore to let patients know a receptionist is available. In fact, this pair of semaphores are incorrect design in this project under the project description. The clinic does not has a hard limit for number of patients could be accommodated in clinic. Since the receptionist is a deamon thread, once it finishes register service for a patient, it will automatically be available for serving next patient's request. Thus, as long as we have a semaphore for waiting patients, we do not need to have another semaphore to let a patient know if a receptionist is able to serve her. Insteadly, we can just notice the patient that her registering is finished by signal another semahore, finishing<sub>registering</sub>.
</p>

<p>
I will use a patient's view to go through the whole process of visiting a doctor. In the following explanation, we will assume a three doctor<sub>and</sub><sub>nurse</sub> threads (0, 1, 2), three patient threads (0, 1, 2), and one receptionist thread scenario. Suppose we are observing patient 1, when she just enter the clinic, she will enqueue her patient id into total patient queue. Due to multithreads' non-deterministic feature, even we start patients in the order 0, 1, 2, their patient ids can be insert in the queue in arbitrary order such as 1, 2, 0. Each of these patients will signal the semahore patients by increment it by 1. We also know the receptionist is waiting on this semaphore, after that the receptionist will dequeue the total patient queue and get patient id 1. Then we assume receptionist enqueue this id to doctor 2's (randomly choice) waiting<sub>patients</sub> queue, and signal finish<sub>registering[patient</sub><sub>id]</sub>. The patient will then signal waitingfordoctor[doctor<sub>id]</sub> to notice doctor<sub>and</sub><sub>nurse</sub> thread and wait for nursecall[doctor<sub>id]</sub>. After that her will follow the nurse to doctor 2's office, signal nursetell[doctor<sub>id]</sub> to let the doctor know she is in the office. Doctor 2 will then listen to her symptoms and giving his advice to her. After she leave the office, patient 1 thread signals leave[patient<sub>id]</sub> and doctor 2 waiting for this semaphore to finish this loop for serving next patient.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Jiashuai Lu</p>
<p class="date">Created: 2018-03-30 Fri 18:43</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"></p>
</div>
</body>
</html>
